<!DOCTYPE html>
<html lang="en" style=" height: 100%;">
<head>
    <meta charset="UTF-8">
    <title>Score Board - Sogeti</title>
    <script type="text/javascript" src="js/socket.io.min.js"></script>
    <script type="text/javascript" src="js/bundle.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet" media="screen">
    <!-- TODO: choper en local! -->
    <link href="https://fonts.googleapis.com/css?family=Covered+By+Your+Grace|Faster+One|Kaushan+Script" rel="stylesheet">
    <style>

        .no-gutter > [class*='col-'] {
            padding-right:0;
            padding-left:0;
        }

        .leaderboard {
            position:relative;
            width:100%;
            height:100%;
        }

        .leaderboard h1{
            text-align: center;
            text-transform: uppercase;
            padding:0;
            color: #cc7713;
        }

        .content {
            position:relative;
            width:100%;
            /*margin:3px auto 0 auto;*/
        }

        .content ul{
            text-align: left;
            margin:0;
            padding:0;
            list-style: none;
            font-size: 1.2em;
            /*border:5px solid #CCC;
            background: rgba(40,40,40,0.75);*/
        }
        .content ul li{
            position: relative;
            color:#FFF;
            font-family: helvetica;
            padding: 0;
            border-bottom: 1px solid #555;
            margin-bottom: 2%;
            background-color: rgba(61, 77, 103, 1);
        }

        .content ul li:last-child{
            border-bottom:none;
        }

        .rank{
            font-weight:bold;
            float:left;
            background-color: #B58A00;
            padding: 0 10px 0 10px;
        }
        .name{
            /*font-weight:bold;*/
            padding: 0 10px 0 10px;
        }
        .count{
            display:inline-block;
            float:right;
            font-weight:bold;
            padding: 0 10px 0 20px;
        }

        /********* BLING **********/
        .content ul{
            border-radius: 20px;
        }

        .animate {
            -moz-animation: flashIt 0.1s ease 1;
            -webkit-animation: flashIt 0.1s ease 1;
            animation: flashIt 0.1s ease 1;
        }

        .animate .countold{
            -moz-animation: spinIt 0.3s ease 1;
            -webkit-animation: spinIt 0.3s ease 1;
            animation: spinIt 0.3s ease 1;
        }


        @-moz-keyframes flashIt {
            100% { opacity: 0; background-color: #FFF;}
        }
        @-webkit-keyframes flashIt {
            100% { opacity: 0; background-color: #FFF;}
        }
        @keyframes flashIt {
            100% { opacity: 0; }
        }

        @-moz-keyframes spinIt {
            20% {-moz-transform: rotate(-10deg)}
            40% {-moz-transform: rotate(10deg)}
            60% {-moz-transform: rotate(-10deg)}
            80% {-moz-transform: rotate(10deg)}
            100% {-moz-transform: rotate(-10deg)}
        }
        @-webkit-keyframes spinIt {
            20% {-webkit-transform: rotate(-10deg)}
            40% {-webkit-transform: rotate(10deg)}
            60% {-webkit-transform: rotate(-10deg)}
            80% {-webkit-transform: rotate(10deg)}
            100% {-webkit-transform: rotate(-10deg)}
        }
        @keyframes spinIt {
            20% {transform: rotate(-10deg)}
            40% {transform: rotate(10deg)}
            60% {transform: rotate(-10deg)}
            80% {transform: rotate(10deg)}
            100% {transform: rotate(-10deg)}
        }
    </style>

</head>
<body  style="min-height:100%;">
<div >
<div class="container-fluid" style="padding:30px" >
    <!-- Example row of columns -->
    <div class="row">
        <div class="col-md-12">
            <div class="row">
        <div class="col-md-4 text-center">
            <img class="rounded-circle" src="img/fouras.jpg" alt="Generic placeholder image" width="140" height="140">
            <h2 style="font-family: 'Kaushan Script', cursive;font-size:30px">Le Questionnaire</h2>
            <div class='leaderboard'>
                <div class="content contentQuestion"></div>
            </div>
        </div>
        <div class="col-md-4 text-center">
            <img class="rounded-circle" src="img/smiley.jpg" alt="Generic placeholder image" width="140" height="140">
            <h2 style="font-family: 'Covered By Your Grace', cursive;font-size:30px">Just Smile !</h2>
            <div class='leaderboard'>
                <div class="content contentSmile"></div>
            </div>
        </div>
        <div class="col-md-4 text-center">
            <img class="rounded-circle" src="img/coursechat.jpg" alt="Generic placeholder image" width="140" height="140">
            <h2 style="font-family: 'Faster One', cursive, cursive;font-size:20px">Course au ch√¢teau!</h2>
            <div class='leaderboard'>
                <div class="content contentRace"></div>
            </div>
        </div>
            </div>
    </div>
        <!-- <div class="col-md-4">
            <div class="row">
                <div class="col-md-12 text-center">
                    <h2 style="font-size:30px">Vos plus beaux visages</h2>
                </div>
                <div class="row">
                  <div class="col-md-8 text-center" style="margin: 0 auto;">
                      <img style="position:absolute;z-index:3;right:10px;bottom:10px" id="emo0" width="50" height="50" src="img/silhouette.png" alt="Generic placeholder image">
                      <img class="rounded-circle img-fluid" id="face0" src="img/silhouette.png" alt="Generic placeholder image">
                  </div>
                  <div class="col-md-8 text-center" style="margin: 0 auto;">
                      <img style="position:absolute;z-index:3;right:10px;bottom:10px" id="emo1" width="50" height="50" src="img/silhouette.png" alt="Generic placeholder image">
                      <img class="rounded-circle img-fluid" id="face1" src="img/silhouette.png" alt="Generic placeholder image">
                  </div>
                </div>
            </div>
        </div> -->
    </div>
    <div class="row" style="margin-top:10px">


    </div>
    </div>


</div> <!-- /container -->
<script src="js/jquery.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script type="text/javascript">
    (function ($) {
        var FakePoller = function(options, callback){
            var defaults = {
                frequency: 60,
                limit: 3,
                page: 1,
                game: 0
            };
            this.callback = callback;
            this.config = $.extend(defaults, options);
        }

        FakePoller.prototype.buildData = function(data) {
          var results = [];
          for (var i = 0, len = data.length; i < len; i++) {
              results.push({
                  rank: i+1,
                  name: data[i].firstname + ' ' + data[i].lastname,
                  count: data[i].score
              });
          }
          return results;
        };

        FakePoller.prototype.processData = function() {
            socket.emit("clientRequestRefresh");
            switch (this.config.game) {
              case 1:
                console.log("J1: " + window.scoreJ1);
                var datas = this.buildData(this.sortData(window.scoreJ1));
                break;
              case 2:
                console.log("J2: " + window.scoreJ2);
                var datas = this.buildData(this.sortData(window.scoreJ2));
                break;
              case 3:
                console.log("J3: " + window.scoreJ3);
                var datas = this.buildData(this.sortData(window.scoreJ3));
                break;
              default:
                var datas = [];
            }

            if(datas.length >= (this.config.limit*this.config.page)){
              this.config.page++;
            }else{
              this.config.page = 1;
            }
            return datas.slice((this.config.page*this.config.limit-this.config.limit), (this.config.page*this.config.limit));
        };

        FakePoller.prototype.sortData = function(data) {
            return data.sort(function(a, b) {
                return b.score - a.score;
            });
        };
        FakePoller.prototype.start = function() {
            var _this = this;
            this.interval = setInterval((function() {
                _this.callback(_this.processData());
            }), this.config.frequency * 1000);
            this.callback(this.processData());
            return this;
        };
        FakePoller.prototype.stop = function() {
            clearInterval(this.interval);
            return this;
        };
        window.FakePoller = FakePoller;

        var Leaderboard = function (elemId, options) {
            var _this = this;
            var defaults = {
                limit:3,
                frequency:15,
                page: 1,
                game: 0
            };
            this.currentItem = 0;
            this.currentCount = 0;
            this.config = $.extend(defaults,options);

            this.$elem = $(elemId);
            if (!this.$elem.length)
                this.$elem = $('<div>').appendTo($('body'));

            this.list = [];
            this.$content = $('<ul>');
            this.$elem.append(this.$content);

            this.poller = new FakePoller({frequency: this.config.frequency, limit: this.config.limit, page: this.config.page, game: this.config.game}, function (data) {
                if (data) {
                    if(_this.currentCount != data.length){
                        _this.buildElements(_this.$content,data.length);
                    }
                    _this.currentCount = data.length;
                    _this.data = data;
                    if(typeof _this.list[0] !== 'undefined')
                    _this.list[0].$item.addClass('animate');
                }
            });
            this.poller.start();
        };

        Leaderboard.prototype.buildElements = function($ul,elemSize){
            var _this = this;
            $ul.empty();
            this.list = [];

            for (var i = 0; i < elemSize; i++) {
                var item = $('<li>')
                    .on("animationend webkitAnimationEnd oAnimationEnd",eventAnimationEnd.bind(this) )
                    .appendTo($ul);
                this.list.push({
                    $item: item,
                    $rank:  $('<span class="rank"></span> ').appendTo(item),
                    $name:  $('<span class="name"></span>').appendTo(item),
                    $count: $('<span class="count"></span>').appendTo(item)
                });
            }

            function eventAnimationEnd (evt){
                this.list[this.currentItem].$rank.text(_this.data[this.currentItem].rank);
                this.list[this.currentItem].$name.text(_this.data[this.currentItem].name);
                this.list[this.currentItem].$count.text(_this.data[this.currentItem].count);
                this.list[this.currentItem].$item.removeClass('animate');
                this.currentItem = this.currentItem >= this.currentCount - 1 ? 0 : this.currentItem + 1;
                if (this.currentItem != 0) {
                    this.list[this.currentItem].$item.addClass('animate');
                }
            }
        };

        Function.prototype.bind = function(){
            var fn = this, args = Array.prototype.slice.call(arguments),
                object = args.shift();
            return function(){
                return fn.apply(object,args.concat(Array.prototype.slice.call(arguments)));
            };
        };

        window.Leaderboard = Leaderboard;

    })(jQuery);

    $(document).ready(function ($) {
        var smileGameBoard = new Leaderboard(".contentSmile", {limit:20,frequency:8, page:1, game:1});
        var questionGameBoard = new Leaderboard(".contentQuestion", {limit:20,frequency:8, page:1, game:3});
        var raceGameBoard = new Leaderboard(".contentRace", {limit:20,frequency:8, page:1, game:2});
    });


</script>
</body>
</html>
