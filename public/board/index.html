<!DOCTYPE html>
<html lang="en" style=" height: 100%;">
<head>
    <meta charset="UTF-8">
    <title>Score Board - Sogeti</title>
    <script type="text/javascript" src="js/socket.io.min.js"></script>
    <script type="text/javascript" src="js/bundle.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet" media="screen">
    <!-- TODO: choper en local! -->
    <link href="https://fonts.googleapis.com/css?family=Covered+By+Your+Grace|Faster+One|Kaushan+Script" rel="stylesheet">
    <style>

        .leaderboard {
            position:relative;
            width:100%;
            height:100%;
            padding:3%;
        }

        .leaderboard h1{
            text-align: center;
            text-transform: uppercase;
            padding:0;
            color: #cc7713;
        }

        .content {
            position:relative;
            width:100%;
            margin:3px auto 0 auto;

        }

        .content ul{
            margin:0;
            padding:0;
            list-style: none;
            border:5px solid #CCC;
            background: rgba(40,40,40,0.75);
        }
        .content ul li{
            position: relative;
            color:#FFF;
            font-family: helvetica;
            padding:2% 5%;
            border-bottom: 1px solid #555;
        }

        .content ul li:last-child{
            border-bottom:none;
        }

        .name{
            font-weight:bold;
        }
        .count{
            display:inline-block;
            float:right;
            color:#F00;
            font-weight:bold;
        }
        .count:after{
            content:' Likes';
            color:#CCC;
            font-size:80%;
            font-weight:normal;
        }


        /********* BLING **********/
        .content ul{
            border-radius: 20px;
        }

        .animate {
            -moz-animation: flashIt 0.2s ease 1;
            -webkit-animation: flashIt 0.2s ease 1;
            animation: flashIt 0.2s ease 1;
        }

        .animate .countold{
            -moz-animation: spinIt 0.3s ease 1;
            -webkit-animation: spinIt 0.3s ease 1;
            animation: spinIt 0.3s ease 1;
        }


        @-moz-keyframes flashIt {
            100% { opacity: 0; background-color: #FFF;}
        }
        @-webkit-keyframes flashIt {
            100% { opacity: 0; background-color: #FFF;}
        }
        @keyframes flashIt {
            100% { opacity: 0; }
        }

        @-moz-keyframes spinIt {
            20% {-moz-transform: rotate(-10deg)}
            40% {-moz-transform: rotate(10deg)}
            60% {-moz-transform: rotate(-10deg)}
            80% {-moz-transform: rotate(10deg)}
            100% {-moz-transform: rotate(-10deg)}
        }
        @-webkit-keyframes spinIt {
            20% {-webkit-transform: rotate(-10deg)}
            40% {-webkit-transform: rotate(10deg)}
            60% {-webkit-transform: rotate(-10deg)}
            80% {-webkit-transform: rotate(10deg)}
            100% {-webkit-transform: rotate(-10deg)}
        }
        @keyframes spinIt {
            20% {transform: rotate(-10deg)}
            40% {transform: rotate(10deg)}
            60% {transform: rotate(-10deg)}
            80% {transform: rotate(10deg)}
            100% {transform: rotate(-10deg)}
        }
    </style>

</head>
<body  style="min-height:100%;">
<div >
<div class="container-fluid" style="padding:30px" >
    <!-- Example row of columns -->
    <div class="row">
        <div class="col-md-6">
            <div class="row">
        <div class="col-md-4 text-center">
            <img class="rounded-circle" src="img/fouras.jpg" alt="Generic placeholder image" width="140" height="140">
            <h2 style="font-family: 'Kaushan Script', cursive;font-size:30px">Le Questionnaire</h2>
        </div>
        <div class="col-md-4 text-center">
            <img class="rounded-circle" src="img/smiley.jpg" alt="Generic placeholder image" width="140" height="140">
            <h2 style="font-family: 'Covered By Your Grace', cursive;font-size:30px">Just Smile !</h2>
            <div class='leaderboard'>
                <div class="content"></div>
            </div>
        </div>
        <div class="col-md-4 text-center">
            <img class="rounded-circle" src="img/coursechat.jpg" alt="Generic placeholder image" width="140" height="140">
            <h2 style="font-family: 'Faster One', cursive, cursive;font-size:20px">Course au ch√¢teau!</h2>
        </div>
            </div>
    </div>
        <div class="col-md-6">
            <div class="row">
                <div class="col-md-12 text-center">
                    <h2 style="font-size:30px">Vos plus beaux visages</h2>
                </div>
                <div class="col-md-6 text-center">
                    <img style="position:absolute;z-index:3;right:10px;bottom:10px" id="emo0" width="50" height="50" src="img/silhouette.png" alt="Generic placeholder image">
                    <img class="rounded-circle img-fluid" id="face0" src="img/silhouette.png" alt="Generic placeholder image">
                </div>
                <div class="col-md-6 text-center">
                    <img style="position:absolute;z-index:3;right:10px;bottom:10px" id="emo1" width="50" height="50" src="img/silhouette.png" alt="Generic placeholder image">
                    <img class="rounded-circle img-fluid" id="face1" src="img/silhouette.png" alt="Generic placeholder image">
                </div>
            </div>
        </div>
    </div>
    <div class="row" style="margin-top:10px">


    </div>
    </div>


</div> <!-- /container -->
<script src="js/jquery.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script type="text/javascript">
    (function ($) {
        var FakePoller = function(options, callback){
            var defaults = {
                frequency: 60,
                limit: 10
            };
            this.callback = callback;
            this.config = $.extend(defaults, options);
        }
        FakePoller.prototype.getData = function() {
            var results = [];
            for (var i = 0, len = window.scoreJ1.length; i < len; i++) {
                results.push({
                    name: window.scoreJ1[i].firstname + ' ' + window.scoreJ1[i].lastname,
                    count: window.scoreJ1[i].score
                });
            }
            return results;
        };
        FakePoller.prototype.processData = function() {
            return this.sortData(this.getData()).slice(0, this.config.limit);
        };

        FakePoller.prototype.sortData = function(data) {
            return data.sort(function(a, b) {
                return b.count - a.count;
            });
        };
        FakePoller.prototype.start = function() {
            var _this = this;
            this.interval = setInterval((function() {
                _this.callback(_this.processData());
            }), this.config.frequency * 1000);
            this.callback(this.processData());
            return this;
        };
        FakePoller.prototype.stop = function() {
            clearInterval(this.interval);
            return this;
        };
        window.FakePoller = FakePoller;

        var Leaderboard = function (elemId, options) {
            var _this = this;
            var defaults = {
                limit:10,
                frequency:15
            };
            this.currentItem = 0;
            this.currentCount = 0;
            this.config = $.extend(defaults,options);

            this.$elem = $(elemId);
            if (!this.$elem.length)
                this.$elem = $('<div>').appendTo($('body'));

            this.list = [];
            this.$content = $('<ul>');
            this.$elem.append(this.$content);

            this.poller = new FakePoller({frequency: this.config.frequency, limit: this.config.limit}, function (data) {
                if (data) {
                    if(_this.currentCount != data.length){
                        _this.buildElements(_this.$content,data.length);
                    }
                    _this.currentCount = data.length;
                    _this.data = data;
                    if(typeof _this.list[0] !== 'undefined')
                    _this.list[0].$item.addClass('animate');
                }
            });

            this.poller.start();
        };

        Leaderboard.prototype.buildElements = function($ul,elemSize){
            var _this = this;
            $ul.empty();
            this.list = [];

            for (var i = 0; i < elemSize; i++) {
                var item = $('<li>')
                    .on("animationend webkitAnimationEnd oAnimationEnd",eventAnimationEnd.bind(this) )
                    .appendTo($ul);
                this.list.push({
                    $item: item,
                    $name: $('<span class="name">Loading...</span>').appendTo(item),
                    $count: $('<span class="count">Loading...</span>').appendTo(item)
                });
            }

            function eventAnimationEnd (evt){
                this.list[this.currentItem].$name.text(_this.data[this.currentItem].name);
                this.list[this.currentItem].$count.text(_this.data[this.currentItem].count);
                this.list[this.currentItem].$item.removeClass('animate');
                this.currentItem = this.currentItem >= this.currentCount - 1 ? 0 : this.currentItem + 1;
                if (this.currentItem != 0) {
                    this.list[this.currentItem].$item.addClass('animate');
                }
            }
        };

        Function.prototype.bind = function(){
            var fn = this, args = Array.prototype.slice.call(arguments),
                object = args.shift();
            return function(){
                return fn.apply(object,args.concat(Array.prototype.slice.call(arguments)));
            };
        };

        window.Leaderboard = Leaderboard;

    })(jQuery);

    $(document).ready(function ($) {
        var myLeaderboard = new Leaderboard(".content", {limit:8,frequency:8});
    });


</script>
</body>
</html>